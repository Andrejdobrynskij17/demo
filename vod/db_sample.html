<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Movie Collections</title>
    <meta name="keywords" content="movie, tv, radio" />
    <meta name="bookmark-image" content="../images/logo.png" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon" />

    <!-- <link media="all" href="../css/autoptimize.css" rel="stylesheet" />
    <script defer src="../js/autoptimize.js"></script> -->

    <link rel="stylesheet" href="../css/mytheme-font.css" type="text/css" />
    <link rel="stylesheet" href="../css/mytheme-ui.css" type="text/css" />
    <link rel="stylesheet" href="../css/mytheme-site.css" type="text/css" />
    <link rel="stylesheet" href="../css/mytheme-share.css" type="text/css" />
    <link rel="stylesheet" href="../css/mytheme-color.css" type="text/css" name="default" />

    <script type="text/javascript" src="../js/jquery.min.js"></script>

    <!-- <script type="text/javascript" src="../js/mytheme-site.js"></script>
    <script type="text/javascript" src="../js/mytheme-ui.js"></script>
    <script type="text/javascript" src="../js/mytheme-cms.js"></script> -->

    <!-- <script type="text/javascript" src="../js/jquery.autocomplete.js"></script> -->

    <link rel="stylesheet" href="../css/mystyle.css" type="text/css" />
    <script type="text/javascript" src="../js/myjavascript.js"></script>
</head>

<body>
    <header class="myui-header__top clearfix" id="header-top">
    <div class="container" style="margin-bottom: 4px;">
        <div class="row">
            <div class="myui-header_bd clearfix">
                <div class="myui-header__logo" style="padding-top: 5px;">
                    <a class="" href="../index.html">
                        <img class="img-responsive hidden-xs" src="../images/logo.png" style="width:100px;height:50px" />
                        <img class="img-responsive visible-xs" src="../images/logo.png" style="width:80px;height:40px" />
                    </a>
                </div>
                <ul class="myui-header__menu">
                  <li class="menu_header"><a href="db_sample.html?t=28" id="menu-movie">電影</a></li>
                  <li class="menu_header"><a href="db_sample.html?t=119" id="menu-tvshow">電視劇</a></li>
                  <li class="menu_header"><a href="db_sample.html?t=128" id="menu-variety">綜藝</a></li>
                  <li class="menu_header"><a href="db_sample.html?t=135" id="menu-animation">動漫</a></li>
                  <li class="menu_header"><a href="db_sample.html?ids=favorites" id="menu-favorites">收藏</a></li>
                  <li class="menu_header" style="width:200px;"></li>
                  <li class="menu_header"><div class="myui-header__search search-box" style="width:220px;">
                  <form id="search" name="search" method="get" action="db_sample.html">
                  <input type="text" id="wd" name="wd" class="search_wd form-control" value=""
                  placeholder="請輸入關鍵字" autocomplete="off" style=" padding-left: 20px; width:240px;" />
                  <button class="submit search_submit" id="searchbutton" type="submit"><i class="fa fa-search"></i></button>
                  </form></div"></li>
                </ul>
            </div>
        </div>
    </div>
    </header>

    <div class="container" style="margin-bottom: 4px;">
      <div class="row">
          <div class="myui-header_bd clearfix">

            <ul class="myui-header__menu" id="myui-menu">
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=1">冒险片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=2">剧情片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=3">动作片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=5">同性片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=6">喜剧片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=7">奇幻片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=8">恐怖片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=9">悬疑片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=10">惊悚片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=11">战争片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=12">歌舞片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=13">灾难片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=14">爱情片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=15">犯罪片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=16">科幻片</a></li>
              <li class="menu_header"><a href="db_sample.html?s=haiwaikan&amp;t=17">经典片</a></li>
            </ul>

          </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
          <div class="myui-panel myui-panel-bg clearfix">
              <div class="myui-panel-box clearfix" id="myui-panel">

              </div>
          </div>
      </div>
    </div>

    <ul class="myui-page text-center clearfix" id="myui-page">
    </ul>

    <div class="myui-foot clearfix">
      <div class="container min">
          <div class="row">
              <div class="col-pd text-center masked">
                  <p class="margin-0">本站為程式開發測試之用，資料蒐集於網際網路，版權歸官方所有 Powered by PKJ Studio 2022</p>
              </div>
          </div>
      </div>
    </div>

</body>
</html>




  <script type="text/javascript" src='../js/sql.js'></script>
  <script>
    // Create an HTML table
    var tableCreate = function () {
      function valconcat(vals, tagName) {
        if (vals.length === 0) return '';
        var open = '<' + tagName + '>', close = '</' + tagName + '>';
        return open + vals.join(close + open) + close;
      }
      return function (columns, values) {
        var tbl = document.createElement('table');
        var html = '<thead>' + valconcat(columns, 'th') + '</thead>';
        var rows = values.map(function (v) { return valconcat(v, 'td'); });
        html += '<tbody>' + valconcat(rows, 'tr') + '</tbody>';
        tbl.innerHTML = html;
        return tbl;
      }
    }();

    let pagename = window.location.pathname.split('/').slice(-1);
    var urlParams;
    (window.onpopstate = function () {
      var match,
        pl     = /\+/g,  // Regex for replacing addition symbol with a space
        search = /([^&=]+)=?([^&]*)/g,
        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
        query  = window.location.search.substring(1);

      urlParams = {};
      while (match = search.exec(query))
        urlParams[decode(match[1])] = decode(match[2]);
    })();


    if (urlParams["t"] == null){ var t = "0"; } else { var t = urlParams["t"];}
    if (urlParams["pg"] == null){ var pg = "1"; } else { var pg = urlParams["pg"];}
    if (urlParams["s"] == null){ var s = "haiwaikan"; } else { var s = urlParams["s"];}


    var db_url = 'https://pkj99.github.io/demo/vod/db/haiwaikan-movie.db';

    // create movie list 
    function movielists(sqlstring){
      const xhr = new XMLHttpRequest();
      xhr.open('GET', db_url, true);
      xhr.responseType = 'arraybuffer';

      xhr.onload = e => {
        const uInt8Array = new Uint8Array(xhr.response);
        const db = new SQL.Database(uInt8Array);
        
        var pagecount = 100;
        var page = (parseInt(pg)-1)*30;
        if (sqlstring.includes("where name like")){
          console.log(sqlstring);
        } else {
          sqlstring += " limit 30 offset " + page
        }
        

        const contents = db.exec(sqlstring);
        var data = JSON.parse(JSON.stringify(contents));
        // console.log(data);
        
        let htmlString = '<ul>';
        
        data = data[0].values;

        for (var i = 0; i < data.length; i++) {
          var m3u8 = data[i][9];
          var img = data[i][10];
          var title = data[i][1];
          var year = data[i][4];
          var quality = data[i][2];
          var type_name = data[i][13];
          var id = data[i][0];        
          var remarks = data[i][14];
          var state = data[i][11];

          htmlString += '<li class="col-lg-10 col-md-8 col-sm-5 col-xs-3">';
          htmlString += '<div class="myui-vodlist__box">';
          htmlString += '<a class="myui-vodlist__thumb lazyload" href="'+pagename+'?s='+s+'&t=' + t + '&id='+ id + '" ';
          htmlString += 'title="' + title +'" ';
          htmlString += 'data-original="' + img + '" ';
          htmlString += 'style="background-image: url(' + img +')"';

          htmlString += '<span class="play hidden-xs"></span>';
          if (quality != '1'){
              htmlString += '<span class="pic-tag pic-tag-top" style="background-color: #5bb7fe;">' + quality+'</span>';
          }
          htmlString += '<span class="pic-tag pic-tag-right">'+remarks+'</span>';
          htmlString += '<span class="pic-text text-right">'+year+'</span>';
          htmlString += '<span class="pic-text text-left">'+type_name+'</span>';

          htmlString += '</a>';
          htmlString += '</div>';
          htmlString += '<div class="myui-vodlist__detail">';
          htmlString += '<h4 class="title text-overflow"><a href="'+m3u8+'">'+title+'</a></h4>';
          htmlString += '</div>';
          htmlString += '</li>';
        }

        htmlString += '</ul>';
        
        document.getElementById('myui-panel').innerHTML = htmlString;
        
        var p = parseInt(pg);
        var bottom_p = parseInt(pagecount);
        var referer = pagename+'?s='+s+'&t=' + t
        if (p > 1) { prev_p = p-1;} else { prev_p = 1;}
        if (p < bottom_p) { next_p = p+1;} else { next_p = bottom_p;}
        var nav = '<li class="hidden-xs"><a class="btn btn-default" href="' + referer+'&pg=1">1</a></li>';
        nav += '<li class="hidden-xs"><a class="btn btn-default" href="' + referer+'&pg=' + prev_p +'">Prev</a></li>';
        for (let i = p - 5; i < p + 5; i++) {
            if ( i == p ) {  nav += '<li class="hidden-xs"><a class="btn btn-warm" href="' + referer+'&pg=' + i +'">'+ i +'</a></li>'; }
            else if ( i < bottom_p && i > 0) {  nav += '<li class="hidden-xs"><a class="btn btn-default" href="' + referer+'&pg=' + i +'">'+ i +'</a></li>'; }
        }

        nav += '<li class="hidden-xs"><a class="btn btn-default" href="' + referer + '&pg=' + next_p +'">Next</a></li>';
        nav += '<li class="hidden-xs"><a class="btn btn-default" href="' + referer + '&pg=' + bottom_p +'">'+bottom_p+'</a></li>';

        // var p = parseInt(pg);
        // var bottom_p = parseInt(pagecount);
        // var referer = pagename+'?s='+s+'&t=' + t
        // var nav = '';
        // if (p > 1) { prev_p = p-1;} else { prev_p = 1;}
        // if (p < bottom_p) { next_p = p+1;} else { next_p = bottom_p;}
        // nav += '<li class="hidden-xs"><a class="btn btn-default" href="' + referer +'&pg=' + prev_p +'">Prev</a></li>';
        // nav += '<li class="hidden-xs"><a class="btn btn-default" href="' + referer +'&pg=' + next_p +'">Next</a></li>';

        document.getElementById('myui-page').innerHTML = nav;

      };
      xhr.send();
    }

    // query by movie id
    function movieById(sqlstring){
      const xhr = new XMLHttpRequest();
      xhr.open('GET', db_url, true);
      xhr.responseType = 'arraybuffer';

      xhr.onload = e => {      
        const uInt8Array = new Uint8Array(xhr.response);
        const db = new SQL.Database(uInt8Array);
        
        var pagecount = 100;
        var page = (parseInt(pg)-1)*30;
        sqlstring += " limit 30 offset " + page
        
        const contents = db.exec(sqlstring);
        var data = JSON.parse(JSON.stringify(contents));
        // console.log(data);
        
        let htmlString = '<ul>';
        
        data = data[0].values;

        for (var i = 0; i < data.length; i++) {
          var id = data[i][0];        
          var m3u8 = data[i][9];
          var img = data[i][10];
          var title = data[i][1];
          var year = data[i][4];
          var quality = data[i][2];
          var type_id = data[i][12];
          var type_name = data[i][13];
          var state = data[i][11];
          var area = data[i][2];
          var lang = data[i][3];
          var actor = data[i][6];
          var director = data[i][7];
          var content = data[i][8];
          var remarks = data[i][14];
          var vod_time = data[i][16];

          htmlString += '<li class="col-lg-4 col-md-3 col-sm-2 col-xs-1">';
          htmlString += '<div class="myui-vodlist__box">';
          htmlString += '<a class="myui-vodlist__thumb lazyload" href="'+ m3u8 + '" ';
          htmlString += 'title="' + title +'" ';
          htmlString += 'data-original="' + img + '" ';
          htmlString += 'style="background-image: url(' + img +')"';

          htmlString += '<span class="play hidden-xs"></span>';
          htmlString += '<span class="pic-tag pic-tag-top" style="background-color: #5bb7fe;">' + quality+'</span>';
          htmlString += '<span class="pic-text text-right">'+year+'</span>';
          htmlString += '<span class="pic-text text-left">'+type_name+'</span>';

          htmlString += '</a>';
          htmlString += '</div>';
          htmlString += '<div class="myui-vodlist__detail">';
          htmlString += '<h4 class="title text-overflow"><a href="'+m3u8+'">'+title+'</a></h4>';
          htmlString += '</div>';
          htmlString += '</li>';

          htmlString += '<li class="col-lg-2 col-md-2 col-sm-1 col-xs-1">';

          htmlString += '<div class="myui-content__detail">';
          htmlString += '<h1 class="title">'+ title +'</h1>';
          htmlString += '<p class="data">';
          htmlString += '<span class="text-muted">分類：</span><a href="'+pagename+'?s='+s+'&t='+type_id+'">'+type_name+'</a>';
          htmlString += '<span class="split-line"></span>';
          htmlString += '<span class="text-muted hidden-xs">地區：</span>'+area;
          htmlString += '<span class="split-line"></span>';
          htmlString += '<span class="text-muted hidden-xs">年份：</span>'+year;
          htmlString += '</p>';
          htmlString += '<p class="data"><span class="text-muted">主演：</span>'+actor+'</p>';
          htmlString += '<p class="data"><span class="text-muted">導演：</span>'+director+'</p>';
          htmlString += '<p class="data"><span class="text-muted">狀態：</span>'+remarks+'</p>';
          htmlString += '<p class="data"><span class="text-muted">更新：</span>'+vod_time+'</p>';
          htmlString += '<p class="data"><span class="text-muted">簡介：</span></p>'+content;
          htmlString += '</div>';

          htmlString += '</li>';


          //  create playlists buttons
          htmlString += '<li class="col-lg-2 col-md-2 col-sm-2 col-xs-1">';
          htmlString += '<div class="myui-content__detail">';

          // const playlists = file.vod_play_url.split('#');
          const playlists = [m3u8];
          if( playlists.length == 1 ){
              htmlString += '<button class="btn btn-primary" type="button" style="font-size: 24px;margin:2px;">';
              htmlString += '<a href="../vod/playvideo.html?url='+m3u8+'">播放</a></button>';
          } else {
            for (let pl of playlists){
                const p = pl.split('$');
                var pl_name = p[0];
                var pl_m3u8 = p[1];
                htmlString += '<a href="'+pl_m3u8+'">';
                htmlString += '<button class="btn btn-outline-primary" type="button" style="width:140px;margin:2px;font-size: 20px;">';
                htmlString += pl_name+'</button></a>';
            }
          }

          htmlString += '<button class="btn btn-secondary" type="button" onclick="setCookieBySourceId(\''+s+'\',\''+id+'\');" id="favorites" '
          htmlString += 'style="font-size: 24px;margin:2px;">收藏</button>';

          // htmlString += '<button class="btn btn-secondary" type="button">';
          // htmlString += '<a style="font-size: 24px;" href="" onclick="setCookieBySourceId('+s+','+id+')" id="favorites">收藏</a></button>';

          htmlString += '</div>';
          htmlString += '</li>';

        }
        htmlString += '</ul>';
        document.getElementById('myui-panel').innerHTML = htmlString;
        // checkCookieBySourceId(s,id);
      }
      xhr.send();
    }




    // var sqlstring = "select * from movie where type_id = 2 order by time desc";
    // movielists(sqlstring);

    if (urlParams["id"] == null) {
      if (urlParams["wd"] == null) {
        var sqlstring = "select * from movie where type_id = "+t+" order by time desc";
        movielists(sqlstring);
      } else {
        var keyword = Simplized(urlParams["wd"])  // 繁轉簡
        var sqlstring = "select * from movie where name like '%"+keyword+"%'";
        movielists(sqlstring);
      }
    } else {
      var id = urlParams["id"];
      var sqlstring = "select * from movie where id = "+id;
      movieById(sqlstring);
    }


  </script>


